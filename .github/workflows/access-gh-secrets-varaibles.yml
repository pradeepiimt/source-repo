name: Update JSON in GitHub Variable
on:
  push:
    branches:
      - feature/pradeep
  workflow_dispatch:
jobs:
  update_json:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Load existing JSON content
        run: |
          echo 'EXISTING_JSON=${{ vars.TREX_DETAILS }}' >> GITHUB_ENV

      - name: Update JSON
        run: |
          # Use jq to update the JSON attribute
          UPDATED_JSON=$(echo  ${{ env.EXISTING_JSON }} | jq '.is_registered = true')
          echo 'UPDATED_JSON=$UPDATED_JSON' >> GITHUB_ENV

      - name: Update GitHub variable
        run: |
          echo $UPDATED_JSON | gh secret set TREX_DETAILS -